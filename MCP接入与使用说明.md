## MCP 接入与使用说明（含自动选工具）

### 1. MCP 的角色
- MCP Server 提供一组“工具”（function/tool）给大模型调用。
- Open WebUI 在向大模型发请求时，把这些工具的结构化描述（name/description/parameters）一并发送。
- 模型据此可自主决定是否调用某个工具（无需人工在前端点击）。

### 2. 工具自动选择的原理
- 关键在于**工具描述足够清晰**：name、description、parameters 三元组告诉模型“这个工具能做什么、怎么用”。
- 模型收到用户问题后，会先推理需求，再匹配可用工具：
  - 例如描述里写“查询业务数据库、订单、用户、日志”，当用户问“最近一周订单数量”，模型会选择 `mysql.query`。
- **不一定需要提示词强制使用工具**；但可加简短系统提示提高稳定性：
  > 当需要查询实时/业务数据时，优先使用可用工具获取准确结果，不要编造数据。

### 3. 最佳实践（以 MySQL 工具为例）
- 工具定义示例（简化）：
  ```json
  {
    "name": "mysql.query",
    "description": "查询业务数据库，执行只读 SQL（SELECT）。",
    "parameters": {
      "type": "object",
      "properties": {
        "sql": { "type": "string", "description": "要执行的 SELECT 语句" }
      },
      "required": ["sql"]
    }
  }
  ```
- 要点：
  - 描述里写清场景（业务库/订单/用户等），让模型易于匹配。
  - 参数校验只允许只读查询，避免模型生成 DML/DDL。
  - 在后端配置里将该工具对目标模型/会话“默认启用”，用户就不用手点“外部工具-MySQL”。

### 4. 常见扩展思路
- **更多数据源**：额外挂接多个 MySQL/PostgreSQL/ES/ClickHouse/Loki 等，用不同工具名区分。
- **知识/文件**：提供“搜索 NAS/S3/MinIO”或“调用外部知识库 API（如 MaxKB）”的工具，返回文档片段给模型。
- **运维/监控**：暴露只读查询 Prometheus/Grafana/CloudWatch 指标的工具，用于故障定位。
- **工单/消息**：创建工单、发 IM/邮件等写入类操作需加白名单和人工确认，控制风险。

### 5. 注意事项
- 工具越多，描述越要简洁明确，避免模型选错；必要时在系统提示中限制“禁止使用某类工具”。
- 写入类操作（发指令、改配置、发消息）务必：
  - 严格参数校验 + 权限控制；
  - 记录日志；必要时“先询问再执行”。


