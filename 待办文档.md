## 共享网盘 + AI 工具功能拓展计划

### 一、目标

- **实现一个共享网盘式的文件空间**：不同用户可以在共享空间中上传、浏览、下载文件。
- **与现有大模型 / RAG 功能打通**：在聊天或工具中选择共享空间里的文件，让模型进行总结、翻译、改写、信息抽取等处理。

### 二、后端改动规划

- **文件空间建模**
  - 在现有文件元数据表上增加字段：
    - `space_type`: `personal | shared`
    - `space_id`: 如 `'global'` 或团队 / 频道 ID（预留扩展）。
  - 或新增一张 `spaces` / `shared_files` 映射表（视现有 schema 而定）。

- **共享空间接口**
  - `GET /api/v1/shared/files`
    - 列出共享空间文件（分页、按上传者过滤）。
  - `POST /api/v1/shared/files`
    - 上传文件到共享空间（保存物理文件 + 创建 `space_type = shared` 记录）。
  - `GET /api/v1/shared/files/{file_id}`
    - 获取文件详情或下载直链（可复用现有 `/api/v1/files/{id}` 逻辑，增加权限判断）。
  - `DELETE /api/v1/shared/files/{file_id}`
    - 删除共享文件（仅限上传者或管理员）。

- **权限模型（V1 简化版）**
  - 所有登录用户：可读取、下载、在聊天/RAG 中引用共享文件。
  - 上传者 + 管理员：可删除。
  - 为后续团队/频道级空间预留 `space_id` 以细化权限。

- **与 RAG / Chat 集成**
  - 支持在 `metadata["files"]` 中传入来自共享空间的 `file_id`。
  - 文档入库与向量化流程与个人上传文件保持一致。

### 三、前端改动规划

- **共享空间页面**
  - 在侧边栏增加入口：`共享空间 / Shared Files`。
  - 页面功能：
    - 文件列表（名称、大小、类型、上传者、时间）。
    - 上传按钮：调用 `POST /api/v1/shared/files`。
    - 操作按钮：下载 / 删除（根据权限显示）。

- **聊天侧集成**
  - 在“附加文件 / 知识”面板中增加一个 Tab：`共享空间`。
  - 支持从共享空间中勾选一个或多个文件作为当前对话的上下文来源。
  - 在消息气泡或侧栏中展示被引用的共享文件列表。

- **AI 工具入口**
  - 在共享空间文件列表中为每个文件提供快捷操作按钮：
    - 一键总结
    - 翻译 / 改写
    - 结构化提取（如提纲、表格抽取）
  - 这些按钮通过调用已有的 Chat / Tool API，并将对应 `file_id` 作为上下文传入。

### 四、后续可选增强

- 团队 / 频道级共享空间（基于 `space_id` 与现有频道/组织模型绑定）。
- 文件版本管理与历史记录。
- 与外部对象存储（如 S3、OSS、COS）打通的大文件支持。


